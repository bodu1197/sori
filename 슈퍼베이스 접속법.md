# SORI 프로젝트 Supabase 접속 가이드

## 기본 정보

| 항목 | 값 |
|------|-----|
| Project ID | `nrtkbulkzhhlstaomvas` |
| Region | Southeast Asia (Singapore) |
| Supabase URL | `https://nrtkbulkzhhlstaomvas.supabase.co` |

---

## API Keys

### ANON KEY (공개용)
```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5ydGtidWxremhobHN0YW9tdmFzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyMDMzNTAsImV4cCI6MjA4MTc3OTM1MH0.uO6uNt8EpLXndjaJ4NOBLvZW-qJor0j4JnoLEXibW48
```

### SERVICE ROLE KEY (관리자용, 주의해서 사용)
```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5ydGtidWxremhobHN0YW9tdmFzIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NjIwMzM1MCwiZXhwIjoyMDgxNzc5MzUwfQ.mDX5Ua4Q8VYWTQsmFpEpx-1Ky_MhpNePs9SPOIuYxiI
```

---

## REST API 사용법

### 기본 형식
```bash
curl "https://nrtkbulkzhhlstaomvas.supabase.co/rest/v1/테이블명" \
  -H "apikey: API_KEY" \
  -H "Authorization: Bearer API_KEY"
```

### 예시: profiles 테이블 조회
```bash
curl "https://nrtkbulkzhhlstaomvas.supabase.co/rest/v1/profiles?limit=10" \
  -H "apikey: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5ydGtidWxremhobHN0YW9tdmFzIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NjIwMzM1MCwiZXhwIjoyMDgxNzc5MzUwfQ.mDX5Ua4Q8VYWTQsmFpEpx-1Ky_MhpNePs9SPOIuYxiI" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5ydGtidWxremhobHN0YW9tdmFzIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NjIwMzM1MCwiZXhwIjoyMDgxNzc5MzUwfQ.mDX5Ua4Q8VYWTQsmFpEpx-1Ky_MhpNePs9SPOIuYxiI"
```

---

## 주요 테이블 목록

| 테이블명 | 설명 |
|----------|------|
| `profiles` | 사용자 프로필 |
| `posts` | 게시물 |
| `post_likes` | 좋아요 |
| `post_comments` | 댓글 |
| `post_hashtags` | 게시물-해시태그 연결 |
| `hashtags` | 해시태그 |
| `follows` | 팔로우 관계 |
| `reposts` | 리포스트 |
| `bookmarks` | 북마크 |
| `stories` | 스토리 |
| `story_views` | 스토리 조회 |
| `saved_songs` | 저장된 음악 |
| `music_albums` | 음악 앨범 |
| `artist_activities` | 아티스트 활동 |
| `conversation_participants` | 대화 참여자 |

---

## JavaScript/TypeScript 사용법

```typescript
import { createClient } from '@supabase/supabase-js'

const supabaseUrl = 'https://nrtkbulkzhhlstaomvas.supabase.co'
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5ydGtidWxremhobHN0YW9tdmFzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyMDMzNTAsImV4cCI6MjA4MTc3OTM1MH0.uO6uNt8EpLXndjaJ4NOBLvZW-qJor0j4JnoLEXibW48'

const supabase = createClient(supabaseUrl, supabaseKey)

// 데이터 조회 예시
const { data, error } = await supabase
  .from('profiles')
  .select('*')
  .limit(10)

// 데이터 삽입 예시
const { data, error } = await supabase
  .from('posts')
  .insert({ user_id: 'uuid', title: '제목', caption: '내용' })

// 데이터 수정 예시
const { data, error } = await supabase
  .from('profiles')
  .update({ full_name: '새 이름' })
  .eq('id', 'uuid')

// 데이터 삭제 예시
const { data, error } = await supabase
  .from('posts')
  .delete()
  .eq('id', 'uuid')
```

---

## Supabase CLI 사용법

### 환경 변수 설정 후 사용
```bash
# Linux/Mac
SUPABASE_ACCESS_TOKEN=sbp_753b67c2411cad6320ef44d6626ac13ee2ba6296 npx supabase projects list

# 프로젝트 정보 조회
SUPABASE_ACCESS_TOKEN=sbp_753b67c2411cad6320ef44d6626ac13ee2ba6296 npx supabase projects api-keys --project-ref nrtkbulkzhhlstaomvas
```

---

## Supabase Management API (SQL 직접 실행)

### Access Token
```
sbp_753b67c2411cad6320ef44d6626ac13ee2ba6296
```

### SQL 쿼리 실행 (테이블 수정, 컬럼 추가 등)
```bash
curl -X POST "https://api.supabase.com/v1/projects/nrtkbulkzhhlstaomvas/database/query" \
  -H "Authorization: Bearer sbp_753b67c2411cad6320ef44d6626ac13ee2ba6296" \
  -H "Content-Type: application/json" \
  -d '{"query":"SELECT * FROM profiles LIMIT 5;"}'
```

### 예시: 컬럼 추가
```bash
curl -X POST "https://api.supabase.com/v1/projects/nrtkbulkzhhlstaomvas/database/query" \
  -H "Authorization: Bearer sbp_753b67c2411cad6320ef44d6626ac13ee2ba6296" \
  -H "Content-Type: application/json" \
  -d '{"query":"ALTER TABLE profiles ADD COLUMN IF NOT EXISTS new_column TEXT;"}'
```

### 예시: NOT NULL 제약 해제
```bash
curl -X POST "https://api.supabase.com/v1/projects/nrtkbulkzhhlstaomvas/database/query" \
  -H "Authorization: Bearer sbp_753b67c2411cad6320ef44d6626ac13ee2ba6296" \
  -H "Content-Type: application/json" \
  -d '{"query":"ALTER TABLE posts ALTER COLUMN video_id DROP NOT NULL;"}'
```

### Python에서 사용
```python
import requests

SUPABASE_ACCESS_TOKEN = "sbp_753b67c2411cad6320ef44d6626ac13ee2ba6296"
PROJECT_ID = "nrtkbulkzhhlstaomvas"

def execute_sql(query: str):
    response = requests.post(
        f"https://api.supabase.com/v1/projects/{PROJECT_ID}/database/query",
        headers={
            "Authorization": f"Bearer {SUPABASE_ACCESS_TOKEN}",
            "Content-Type": "application/json"
        },
        json={"query": query}
    )
    return response.json()

# 사용 예시
result = execute_sql("SELECT COUNT(*) FROM profiles;")
print(result)
```

---

## Auth Admin API (사용자 생성/관리)

### 가상 회원 생성 (Virtual Member)
```bash
curl -X POST "https://nrtkbulkzhhlstaomvas.supabase.co/auth/v1/admin/users" \
  -H "apikey: SERVICE_ROLE_KEY" \
  -H "Authorization: Bearer SERVICE_ROLE_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "artist_id@sori.virtual",
    "password": "secure_password",
    "email_confirm": true,
    "user_metadata": {
      "full_name": "아티스트 이름",
      "is_virtual_member": true
    }
  }'
```

---

## 주의사항

1. **SERVICE_ROLE 키는 서버사이드에서만 사용** - 클라이언트에 노출 금지
2. **ANON 키는 클라이언트에서 사용 가능** - RLS(Row Level Security) 정책 적용됨
3. **API 키 유출 주의** - .gitignore에 환경변수 파일 추가 필수
4. **Management API Access Token** - 서버사이드/CI/CD에서만 사용
