# ğŸŒ êµ­ê°€ë³„ ë§ì¶¤ ì½˜í…ì¸  ê°€ì´ë“œ

> ê° ë‚˜ë¼ ì‚¬ìš©ìì—ê²Œ í•´ë‹¹ êµ­ê°€ì˜ ì‹ ê·œ ì•¨ë²”, ì°¨íŠ¸ ì œê³µí•˜ê¸°

---

## ğŸ¯ í•µì‹¬ ì»¨ì…‰

```
ğŸ‡°ğŸ‡· í•œêµ­ ì‚¬ìš©ì â†’ í•œêµ­ ì‹ ê·œ ì•¨ë²” (ì•„ì´ìœ , BTS, ë‰´ì§„ìŠ¤)
ğŸ‡¯ğŸ‡µ ì¼ë³¸ ì‚¬ìš©ì â†’ ì¼ë³¸ ì‹ ê·œ ì•¨ë²” (YOASOBI, Ado)
ğŸ‡ºğŸ‡¸ ë¯¸êµ­ ì‚¬ìš©ì â†’ ë¯¸êµ­ ì‹ ê·œ ì•¨ë²” (Taylor Swift, Drake)
```

---

## ğŸ”§ êµ­ê°€ ê°ì§€ ë°©ë²•

### 1. IP ìë™ ê°ì§€ (ê¶Œì¥)

```python
# Cloudflare/Vercel í—¤ë” ì‚¬ìš©
country = request.headers.get("CF-IPCountry", "US")
```

### 2. ì‚¬ìš©ì ì§ì ‘ ì„ íƒ

```sql
ALTER TABLE profiles ADD COLUMN country_code VARCHAR(2) DEFAULT 'US';
```

---

## ğŸµ ytmusicapi êµ­ê°€ë³„ ì„¤ì •

```python
from ytmusicapi import YTMusic

# êµ­ê°€ë³„ ì¸ìŠ¤í„´ìŠ¤
YTMUSIC_INSTANCES = {
    'KR': YTMusic(language='ko', location='KR'),
    'JP': YTMusic(language='ja', location='JP'),
    'US': YTMusic(language='en', location='US'),
    'DE': YTMusic(language='de', location='DE'),
    'BR': YTMusic(language='pt', location='BR'),
}

# ì°¨íŠ¸ ê°€ì ¸ì˜¤ê¸°
ytmusic_kr = YTMUSIC_INSTANCES['KR']
kr_charts = ytmusic_kr.get_charts(country='KR')
kr_albums = ytmusic_kr.get_new_albums()
```

---

## ğŸ’» ë°±ì—”ë“œ API ì˜ˆì‹œ

```python
from fastapi import FastAPI, Request
import redis, json, os

app = FastAPI()
cache = redis.from_url(os.getenv("REDIS_URL"))

SUPPORTED_COUNTRIES = {
    'KR': {'name': 'í•œêµ­', 'flag': 'ğŸ‡°ğŸ‡·'},
    'JP': {'name': 'ì¼ë³¸', 'flag': 'ğŸ‡¯ğŸ‡µ'},
    'US': {'name': 'ë¯¸êµ­', 'flag': 'ğŸ‡ºğŸ‡¸'},
}

@app.get("/api/new-albums")
async def get_new_albums(request: Request, country: str = None):
    # êµ­ê°€ ê²°ì •
    if not country:
        country = request.headers.get("CF-IPCountry", "US")

    # ìºì‹œ í™•ì¸
    cache_key = f"new_albums:{country}"
    cached = cache.get(cache_key)
    if cached:
        return json.loads(cached)

    # API í˜¸ì¶œ
    ytmusic = YTMUSIC_INSTANCES.get(country, YTMUSIC_INSTANCES['US'])
    albums = ytmusic.get_new_albums()

    # ìºì‹œ ì €ì¥ (1ì‹œê°„)
    cache.setex(cache_key, 3600, json.dumps(albums))
    return albums

@app.get("/api/charts")
async def get_charts(request: Request, country: str = None):
    if not country:
        country = request.headers.get("CF-IPCountry", "US")

    cache_key = f"charts:{country}"
    cached = cache.get(cache_key)
    if cached:
        return json.loads(cached)

    ytmusic = YTMUSIC_INSTANCES.get(country, YTMUSIC_INSTANCES['US'])
    charts = ytmusic.get_charts(country=country)
    cache.setex(cache_key, 3600, json.dumps(charts))
    return charts
```

---

## ğŸ“‹ ì§€ì› êµ­ê°€ ëª©ë¡

| ì½”ë“œ | êµ­ê°€   | ì–¸ì–´ | í”Œë˜ê·¸ |
| :--: | ------ | ---- | :----: |
|  KR  | í•œêµ­   | ko   |   ğŸ‡°ğŸ‡·   |
|  JP  | ì¼ë³¸   | ja   |   ğŸ‡¯ğŸ‡µ   |
|  US  | ë¯¸êµ­   | en   |   ğŸ‡ºğŸ‡¸   |
|  GB  | ì˜êµ­   | en   |   ğŸ‡¬ğŸ‡§   |
|  DE  | ë…ì¼   | de   |   ğŸ‡©ğŸ‡ª   |
|  FR  | í”„ë‘ìŠ¤ | fr   |   ğŸ‡«ğŸ‡·   |
|  BR  | ë¸Œë¼ì§ˆ | pt   |   ğŸ‡§ğŸ‡·   |

---

## âœ… êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] êµ­ê°€ë³„ YTMusic ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
- [ ] êµ­ê°€ ê°ì§€ ë¡œì§ (í—¤ë” ê¸°ë°˜)
- [ ] êµ­ê°€ë³„ ìºì‹± ì ìš©
- [ ] êµ­ê°€ ì„ íƒ UI êµ¬í˜„
- [ ] profiles í…Œì´ë¸”ì— country_code ì¶”ê°€
